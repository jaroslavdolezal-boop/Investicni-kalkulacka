<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Definitivní Investiční Kalkulačka</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root { --p: #4f46e5; --s: #10b981; --bg: #f1f5f9; }
        body { font-family: sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        .card { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--p); }
        .inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .group { display: flex; flex-direction: column; }
        label { font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #64748b; }
        input, select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; }
        .res { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .box { padding: 15px; background: #f8fafc; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0; }
        .box div { font-size: 0.7rem; color: #64748b; text-transform: uppercase; }
        .box strong { font-size: 1.2rem; color: var(--p); display: block; margin-top: 5px; }
        .chart-wrap { height: 350px; position: relative; }
    </style>
</head>
<body>

<div class="card">
    <h2>Investiční kalkulačka</h2>
    
    <div class="inputs">
        <div class="group">
            <label>Počáteční vklad (Kč)</label>
            <input type="number" id="in_init" value="10000">
        </div>
        <div class="group">
            <label>Měsíční vklad (Kč)</label>
            <input type="number" id="in_mon" value="2000">
        </div>
        <div class="group">
            <label>Doba (let)</label>
            <input type="number" id="in_years" value="10">
        </div>
        <div class="group">
            <label>Zhodnocení (% p.a.)</label>
            <input type="number" id="in_roi" value="7">
        </div>
        <div class="group">
            <label>Inflace (%)</label>
            <input type="number" id="in_inf" value="3">
        </div>
        <div class="group">
            <label>Úročení</label>
            <select id="in_freq">
                <option value="12">Měsíčně</option>
                <option value="1">Ročně</option>
            </select>
        </div>
        <div class="group">
            <label>Navýšit vklad každých (let)</label>
            <input type="number" id="in_step_y" value="1">
        </div>
        <div class="group">
            <label>O kolik navýšit (Kč)</label>
            <input type="number" id="in_step_v" value="500">
        </div>
    </div>

    <div class="res">
        <div class="box"><div>Konečná suma</div><strong id="out_nom">0 Kč</strong></div>
        <div class="box"><div>Reálná hodnota</div><strong id="out_real" style="color:var(--s)">0 Kč</strong></div>
        <div class="box"><div>Celkem vloženo</div><strong id="out_inv">0 Kč</strong></div>
    </div>

    <div class="chart-wrap">
        <canvas id="myChart"></canvas>
    </div>
</div>

<script>
    let myChart = null;

    function run() {
        // Načtení hodnot
        const init = parseFloat(document.getElementById('in_init').value) || 0;
        let mon = parseFloat(document.getElementById('in_mon').value) || 0;
        const years = parseInt(document.getElementById('in_years').value) || 1;
        const roi = (parseFloat(document.getElementById('in_roi').value) || 0) / 100;
        const inf = (parseFloat(document.getElementById('in_inf').value) || 0) / 100;
        const freq = parseInt(document.getElementById('in_freq').value);
        const stepY = parseInt(document.getElementById('in_step_y').value) || 1;
        const stepV = parseFloat(document.getElementById('in_step_v').value) || 0;

        let total = init;
        let invested = init;
        
        let dataNom = [init];
        let dataInv = [init];
        let dataReal = [init];
        let labels = ["Start"];

        // Výpočet po měsících
        for (let m = 1; m <= years * 12; m++) {
            // Přidání vkladu
            total += mon;
            invested += mon;

            // Úročení
            if (m % (12 / freq) === 0) {
                total *= (1 + (roi / freq));
            }

            // Navýšení měsíčního vkladu
            if (m % (stepY * 12) === 0) {
                mon += stepV;
            }

            // Uložení bodu do grafu (každý rok)
            if (m % 12 === 0) {
                let y = m / 12;
                labels.push(y + ". rok");
                dataNom.push(Math.round(total));
                dataInv.push(Math.round(invested));
                // Reálná hodnota (očištěno o inflaci)
                dataReal.push(Math.round(total / Math.pow(1 + inf, y)));
            }
        }

        // Výpis výsledků
        const fmt = new Intl.NumberFormat('cs-CZ');
        document.getElementById('out_nom').innerText = fmt.format(Math.round(total)) + " Kč";
        document.getElementById('out_inv').innerText = fmt.format(Math.round(invested)) + " Kč";
        document.getElementById('out_real').innerText = fmt.format(Math.round(dataReal[dataReal.length-1])) + " Kč";

        // Vykreslení grafu
        draw(labels, dataNom, dataInv, dataReal);
    }

    function draw(labels, nom, inv, real) {
        const ctx = document.getElementById('myChart');
        if (!ctx) return;
        
        if (myChart) myChart.destroy();

        // Kontrola, zda je Chart.js načteno
        if (typeof Chart === 'undefined') {
            ctx.parentNode.innerHTML = "<p style='color:red; text-align:center'>Chyba: Knihovna pro grafy se nenačetla. Zkontrolujte připojení k internetu.</p>";
            return;
        }

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Nominální hodnota', data: nom, borderColor: '#4f46e5', tension: 0.1, fill: false },
                    { label: 'Vložená částka', data: inv, borderColor: '#94a3b8', tension: 0.1, fill: false },
                    { label: 'Reálná hodnota', data: real, borderColor: '#10b981', borderDash: [5,5], tension: 0.1, fill: false }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                scales: { y: { beginAtZero: true } }
            }
        });
    }

    // Spustit při změně a při načtení
    document.querySelectorAll('input, select').forEach(el => el.oninput = run);
    window.onload = run;
</script>

</body>
</html>
